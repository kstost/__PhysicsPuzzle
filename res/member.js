$mmb={api:{login:(e,t)=>new Promise((i,c)=>{$network.call("login",{id:e,pwd:t},{success:function(e){e.result&&g_localAdvStorage.set("authkey",e.key),i(e.result)},error:function(){c()},complete:function(){}})}),checklogin:()=>new Promise((e,t)=>{$network.call("checklogin",{},{success:function(t){e(t.logined)},error:function(){t()},complete:function(){}})})},make_account_office(e){void 0===e.history&&(e.history=[]);let t=vs.get("member_center",{}).avatar;t&&(e.avatar_current=t);let{history:i,office_group:c,container:n,step:o,end_callback_before:l,end_callback_after:r,avatar_resources:a,avatar_current:s}=e;function p(t,c,n,l,r){let a;n?i.push(o):i.pop(),console.log(i),null!==c&&(a=$mmb.make_account_office({...e,step:c})),l&&l(),function(e,t,i,c){t&&(t.office.element.x=$pxi.ccc(GAME_VIRTUAL_WIDTH)*(i?1:-1));commonutil.animation((n,o)=>{e.element.x=$pxi.ccc(GAME_VIRTUAL_WIDTH)*n*(i?-1:1),t&&(t.office.element.x=i?$pxi.ccc(GAME_VIRTUAL_WIDTH)-$pxi.ccc(GAME_VIRTUAL_WIDTH)*n:-$pxi.ccc(GAME_VIRTUAL_WIDTH)+$pxi.ccc(GAME_VIRTUAL_WIDTH)*n),o&&(e.close(),t&&t.textbox&&t.textbox.set_focus(),c&&c())},300,constvalue.easing.easeOutQuad)}(t,a,n,r)}function d(e,t){let i=null===t,c=!0;p(e,i?null:t+1,c,e=>{i&&l&&l(c)},e=>{i&&r&&r(c)})}function h(e){if(i&&i.length){return p(e,i[i.length-1],!1,()=>{},()=>{}),!0}return function(e,t){let i=!1;(null===t||t<2)&&(i=!0,t=null);let c=!1;p(e,i?null:t-1,c,e=>{i&&l&&l(c)},e=>{i&&r&&r(c)})}(e,null),!1}let x={};if(5===o){let e=$mmb.make_basic_office({group:c,title:"MEMBER CENTER",container:n,btn:{negative:{res:"NO",exe:()=>{vs.get("member_center",{}).avatar=t.profile,h(e)}},positive:{res:"YES",exe:()=>{vs.get("member_center",{}).avatar=t.profile,p(e,2,!0,()=>{},()=>{})}}}});x.office=e;let t=$mmb.avatar_face({group:c,container:e.element,data:a}),i=$pxi.ccc(1080)/2;t.set_size(i),t.clear(),Object.keys(s).forEach(e=>{t.set_avatar(e,s[e])}),t.element.y=t.element.x=$pxi.ccc(GAME_VIRTUAL_WIDTH)/2-t.element.width/2;let o=.2*$pxi.ccc(1080),l=t.element.y,r=$mmb.avatar_tool({ava:t,group:c,container:e.element,data:a}),d=$pxi.ccc(1080)/2.2;r.set_size(d),r.clear(),r.clear(),r.element.x=$pxi.ccc(1080)-d-$pxi.ccc(xk.res_list.circle_button.width),r.element.y=l+i+o;let g,u=Object.keys(a),f={};function _(e){Object.keys(f).forEach(e=>{let t=f[e];t.texture=t.extend_res.off});let i=f[e];i.texture=i.extend_res.on,r.clear(),r.set_avatar(e,t.profile[e])}u.forEach(t=>{let n={on:xk.res_list["avatar_tool_on_"+t],off:xk.res_list["avatar_tool_off_"+t]};if(n.on){let r=$pxi.image_sprite(n.off);r.parentGroup=c,r.extend_res=n,f[t]=r,r.scale.x*=.9,r.scale.y*=.9,r.x=$pxi.ccc(xk.res_list.circle_button.width),r.y=0+(g?g.y+g.height:l+i+o),e.element.addChild(r),g=r,r.interactive=!0,r.mousedown=r.touchstart=function(){_(t)}}}),_("hair")}if(4===o){let e=$mmb.make_basic_office({group:c,title:"LOGIN",container:n,btn:{negative:{res:"취소",exe:()=>{h(e)}},positive:{res:"로그인",exe:()=>{let t=o.id.text,i=o.pwd.text;(async()=>{if(await $mmb.api.login(t,i))d(e,null);else{let e=[{name:"아..",exe:e=>{i.remove()}}],t="패스워드가 맞지 않아요",i=$cpn.dialogbox({...$cpn.dialogbox(),parent:n,group:c,list:e,text:t})}})()}}}});x.office=e;let t=$pxi.textlabel({text:"로그인 해주세요",size:$pxi.ccc(70),parent:e.element,family:"NEXON-Lv1-Gothic-Light"});t.getNode().tint=0,t.y=$pxi.ccc(150)+2*t.height,t.x+=($pxi.ccc(GAME_VIRTUAL_WIDTH)-t.width)/2;let i=[{key:"id",placeholder:"아이디",secure:!1},{key:"pwd",placeholder:"패스워드",secure:!0}],o={},l=.02*$pxi.ccc(GAME_VIRTUAL_HEIGHT);for(let n=0;n<i.length;n++){let r=$cpn.make_edit_text({...i[n],group:c,container:e.element,onchange:e=>{},onfocus:e=>{},onblur:e=>{}});x.textbox=r,r.size=$pxi.ccc(100),r.align=1,r.text="",r.width=.7*$pxi.ccc(1080),r.x=($pxi.ccc(1080)-r.width)/2,r.y=t.y-t.height/2+2*t.height+(r.height+l)*n,o[i[n].key]=r}let r=$pxi.ccc(10.8),a=$cpn.make_button({radius:r,font_size:$pxi.ccc(40),fontFamily:"NEXON-Lv1-Gothic-Light",tickness:.002*$pxi.ccc(GAME_VIRTUAL_WIDTH),color:[9531405,16760576,3355443],label:"아이디가 없다면 만들자",parent:e.element,group:c,margin:.003*$pxi.ccc(GAME_VIRTUAL_WIDTH),size:{width:$pxi.ccc(GAME_VIRTUAL_WIDTH)/2,height:$pxi.ccc(GAME_VIRTUAL_WIDTH)/10},onclick:()=>{vs.set("member_center",{}),p(e,1,!0,()=>{},()=>{})}});console.log(a),a.width=$pxi.ccc(GAME_VIRTUAL_WIDTH)/1.5,a.fit_height(),a.fit_width(),a.width=o.id.width,a.height=.05*$pxi.ccc(GAME_VIRTUAL_HEIGHT),a.x=o.id.x,a.y=o.pwd.y+o.pwd.height+l}if(3===o){let e=vs.get("member_center",{}).password,t=$mmb.make_basic_office({group:c,title:"MEMBER CENTER",container:n,btn:{negative:{res:"뒤로",exe:()=>{h(t)}},positive:{res:"확인",exe:()=>{if(l)$network.call("regist",{id:vs.get("member_center").userid,pwd:vs.get("member_center").password,avatar:JSON.stringify(vs.get("member_center").avatar)},{success:function(e){e.result&&g_localAdvStorage.set("authkey",e.key),d(t,null)},error:function(){},complete:function(){}});else{let e=[{name:"확인",exe:e=>{i.remove(),o.set_focus()}}],t="패스워드를 잘 입력해주세요",i=$cpn.dialogbox({...$cpn.dialogbox(),parent:n,group:c,list:e,text:t})}}}}});x.office=t;let i=$pxi.textlabel({text:"다시 한번 똑같이 입력해주세요",size:$pxi.ccc(70),parent:t.element,family:"NEXON-Lv1-Gothic-Light"});i.getNode().tint=0,i.y=$pxi.ccc(150)+2*i.height,i.x+=($pxi.ccc(GAME_VIRTUAL_WIDTH)-i.width)/2;let o=$cpn.make_edit_text({secure:!0,group:c,container:t.element,onchange:e=>{g(e)||(r.getNode().alpha=0)},onfocus:e=>{g(o.text)||(r.getNode().alpha=0)},onblur:e=>{g(o.text)}});x.textbox=o;let l=!1;function g(t){return r.getNode().alpha=1,l=!1,e===t?(l=!0,r.text="좋아요",r.getNode().tint=1030144):(r.text="맞지 않아요",r.getNode().tint=11010048),""===t&&(r.getNode().alpha=0),e===t}o.size=$pxi.ccc(100),o.align=1,o.text="",o.y=i.y-i.height/2+2*i.height,o.width=.7*$pxi.ccc(1080),o.x=($pxi.ccc(1080)-o.width)/2;let r=$pxi.textlabel({text:"",size:$pxi.ccc(50),parent:t.element,family:"NEXON-Lv1-Gothic-Light"});r.getNode().alpha=0,r.y+=o.y+o.height+.5*o.height,r.x+=($pxi.ccc(GAME_VIRTUAL_WIDTH)-r.width)/2}if(2===o){let e=$mmb.make_basic_office({group:c,title:"MEMBER CENTER",container:n,btn:{negative:{res:"NO",exe:()=>{vs.get("member_center",{}).password=l.text,h(e)}},positive:{res:"YES",exe:()=>{if(i>1)vs.get("member_center",{}).password=l.text,d(e,o);else{let e=[{name:"확인",exe:e=>{i.remove(),l.set_focus()}}],t="좀더 패스워드를 강력하게 해봅시다",i=$cpn.dialogbox({...$cpn.dialogbox(),parent:n,group:c,list:e,text:t})}}}}});x.office=e;let t=$pxi.textlabel({text:"사용할 패스워드를 정해주세요",size:$pxi.ccc(70),parent:e.element,family:"NEXON-Lv1-Gothic-Light"});t.getNode().tint=0,t.y=$pxi.ccc(150)+2*t.height,t.x+=($pxi.ccc(GAME_VIRTUAL_WIDTH)-t.width)/2;let i=0;function u(){if(0===l.text.trim().length)a.getNode().alpha=0;else{a.getNode().alpha=1,i=Math.round(function(e){var t=0;if(!e)return t;for(var i=new Object,c=0;c<e.length;c++)i[e[c]]=(i[e[c]]||0)+1,t+=5/i[e[c]];var n={digits:/\d/.test(e),lower:/[a-z]/.test(e),upper:/[A-Z]/.test(e),nonWords:/\W/.test(e)};for(var o in variationCount=0,n)variationCount+=1==n[o]?1:0;return t+=10*(variationCount-1),parseInt(t)}(l.text)/20);let e=[{color:11010048,desc:"약해요"},{color:12747008,desc:"별로예요"},{color:8626432,desc:"괜찮아요"},{color:1030144,desc:"좋아요"},{color:1030144,desc:"더좋아요"},{color:1030144,desc:"더더좋아요"},{color:1030144,desc:"더더더좋아요"},{color:1030144,desc:"더더더더좋아요"},{color:1030144,desc:"더더더더더좋아요"},{color:1030144,desc:"더더더더더더좋아요"},{color:1030144,desc:"와아아아"},{color:1030144,desc:"길다아아아아앙"}];i>=e.length&&(i=e.length-1),a.text=String(e[i].desc),a.getNode().tint=e[i].color}}let l=$cpn.make_edit_text({secure:!0,group:c,container:e.element,onchange:e=>{u()},onfocus:e=>{u()},onblur:e=>{u()}});x.textbox=l,l.size=$pxi.ccc(100),l.align=1;let r=vs.get("member_center",{}).password;l.text=r||"",l.y=t.y-t.height/2+2*t.height,l.width=.7*$pxi.ccc(1080),l.x=($pxi.ccc(1080)-l.width)/2;let a=$pxi.textlabel({text:"너무 간단해요",size:$pxi.ccc(50),parent:e.element,family:"NEXON-Lv1-Gothic-Light"});a.getNode().tint=11141120,a.y+=l.y+l.height+.5*l.height,a.x+=($pxi.ccc(GAME_VIRTUAL_WIDTH)-a.width)/2,u()}if(1===o){let e=$mmb.make_basic_office({group:c,title:"MEMBER CENTER",container:n,btn:{negative:{res:"NO",exe:()=>{h(e)}},positive:{res:"YES",exe:()=>{if(1===l)$mmb.make_policy({no:()=>{},yes:()=>{vs.get("member_center",{}).userid=i.text,p(e,5,!0,()=>{},()=>{})}});else{let e=[{name:"확인",exe:e=>{o.remove(),i.set_focus()}}],t="아이디를 다시 확인해주세요",o=$cpn.dialogbox({...$cpn.dialogbox(),parent:n,group:c,list:e,text:t})}}}}});x.office=e;let t=$pxi.textlabel({text:"사용할 아이디를 정해주세요",size:$pxi.ccc(70),parent:e.element,family:"NEXON-Lv1-Gothic-Light"});t.getNode().tint=0,t.y=$pxi.ccc(150)+2*t.height,t.x+=($pxi.ccc(GAME_VIRTUAL_WIDTH)-t.width)/2;let i=$cpn.make_edit_text({group:c,container:e.element,onfocus:e=>{r.getNode().alpha=0},onblur:e=>{r.getNode().alpha=1;let t=i.text.trim();t?(g(3),$network.call("checkexist",{id:$jsc.urlencode(t)},{success:function(e){e.exist&&g(0),e.exist||g(1)},error:function(){reject()},complete:function(){}})):g(2)},onchange:e=>{}});x.textbox=i,i.size=$pxi.ccc(100),i.align=1;let o=vs.get("member_center",{}).userid;i.text=o||"",i.y=t.y-t.height/2+2*t.height,i.width=.7*$pxi.ccc(1080),i.x=($pxi.ccc(1080)-i.width)/2;let l,r=$pxi.textlabel({text:"",size:$pxi.ccc(50),parent:e.element,family:"NEXON-Lv1-Gothic-Light"});function g(e){l=e,0===e&&(r.text="이미 사용중입니다",r.getNode().tint=11141120),1===e&&(r.text="사용 가능합니다",r.getNode().tint=46348),2===e&&(r.text="사용할 아이디를 입력해주세요",r.getNode().tint=11141120),3===e&&(r.text="확인중입니다",r.getNode().tint=11184810),r.y=i.y+i.height+.5*i.height,r.x=r.width/2+($pxi.ccc(GAME_VIRTUAL_WIDTH)-r.width)/2}}return x},avatar_tool({data:e,container:t,group:i,ava:c}){let n,o,l=0,r={},a=[],s={body:1,face:2,hair:10,eyes:1,nose:1,mouth:1,eb:1},p=new PIXI.Container;p.x=0,p.y=0,i&&(p.parentGroup=i),t.addChild(p);let d=new PIXI.Sprite(PIXI.Texture.WHITE);d.x=0,d.y=0,i&&(d.parentGroup=i),p.addChild(d);let h=$pxi.image_sprite(xk.res_list.circle_button);h.zOrder=100,i&&(h.parentGroup=i),p.addChild(h);let x=$pxi.image_sprite(xk.res_list.circle_button);function _(e,t){u(e,t);let i=JSON.parse(JSON.stringify(c.profile));i[e]=t,c.clear(),Object.keys(i).forEach(e=>{c.set_avatar(e,i[e])})}function g(){for(;a.length;){let e=a.splice(0,1)[0];e.parent.removeChild(e)}Object.keys(r).forEach(e=>{delete r[e]})}function u(t,c){n=t,o=c;let d=$pxi.image_sprite(e[t][c]);r[t]=c,d.height=d.width=l,d.x=0,d.y=0,d.zOrder=s[t],i&&(d.parentGroup=i),p.addChild(d),a.push(d)}return x.zOrder=100,x.rotation=Math.PI,i&&(x.parentGroup=i),p.addChild(x),h.interactive=!0,h.mousedown=h.touchstart=function(){n&&(g(),o--,o<0&&(o=e[n].length-1),_(n,o))},x.interactive=!0,x.mousedown=x.touchstart=function(){n&&(g(),o++,o>=e[n].length&&(o=0),_(n,o))},{profile:r,element:p,clear:g,set_avatar:u,set_size:function(e){l=e,d.width=e,d.height=e,a.forEach(e=>{e.width=l,e.height=l}),h.x=-h.width/2,h.y=e/2-h.height/2,x.x=e+x.height/2,x.y=x.height+(e/2-x.height/2)}}},avatar_face({data:e,container:t,group:i}){let c=0,n={},o=[],l={body:1,face:2,hair:10,eyes:1,nose:1,mouth:1,eb:1},r=new PIXI.Container;r.x=0,r.y=0,i&&(r.parentGroup=i),t.addChild(r);let a=$pxi.image_sprite(xk.res_list.avatar_stamp);i&&(a.parentGroup=i),r.addChild(a),a.x=0,a.y=0;let s=new PIXI.Sprite(PIXI.Texture.WHITE);return s.x=$pxi.ccc((a.width-s.width)/2),s.y=$pxi.ccc((a.height-s.height)/2),i&&(s.parentGroup=i),r.addChild(s),{profile:n,element:r,clear:function(){for(;o.length;){let e=o.splice(0,1)[0];e.parent.removeChild(e)}Object.keys(n).forEach(e=>{delete n[e]})},set_avatar:function(t,a){let p=$pxi.image_sprite(e[t][a]);n[t]=a,p.height=p.width=c,p.x=s.x,p.y=s.y,p.zOrder=l[t],i&&(p.parentGroup=i),r.addChild(p),o.push(p)},set_size:function(e){c=e,s.width=e,s.height=e,o.forEach(e=>{e.width=c,e.height=c})}}},make_policy(e){WEBCOMPONENT.visible(!0);let t=$wcm.makeblack();WEBCOMPONENT.view.appendChild(t);{let i=$wcm.ccc(GAME_VIRTUAL_WIDTH/40),c=$wcm.ccc(GAME_VIRTUAL_WIDTH/20),n=$wcm.view();n.style.padding=i+"px",n.style.background="#fff",n.style.top=c+"px",n.style.bottom=c+"px",n.style.left=c+"px",n.style.right=c+"px",WEBCOMPONENT.view.appendChild(n);let o=document.createElement("div");o.classList.add("font_bold"),o.textContent="개인정보 처리방침",n.appendChild(o);let l,r=fit_fontsize_to_pixel_scale(o,o.getBoundingClientRect().width/3,!0),a=fit_fontsize_to_pixel_scale(o,o.getBoundingClientRect().width/2,!0);{let e=document.createElement("div");e.style.height=i+"px",n.appendChild(e)}{let e=document.querySelector("#element_privacy").cloneNode(!0);e.removeAttribute("id"),e.classList.add("font_light"),e.classList.remove("invisible"),e.style.fontSize=r.fontSize,e.style.overflow="auto",e.style.height=$wcm.ccc(GAME_VIRTUAL_WIDTH)+"px",e.querySelectorAll(".terms_big_title").forEach(e=>{e.classList.add("font_light")}),e.querySelectorAll(".term_section_body").forEach(e=>{e.style.paddingLeft=$wcm.ccc(GAME_VIRTUAL_WIDTH/40)+"px"}),e.querySelectorAll(".term_section_sub").forEach(e=>{e.style.paddingLeft=$wcm.ccc(GAME_VIRTUAL_WIDTH/40)+"px"}),n.appendChild(e),l=e}{let e=document.createElement("div");e.style.height=i+"px",n.appendChild(e)}let s=[];{let i=document.createElement("div");i.classList.add("font_light"),i.textContent="취소",i.style.fontSize=a.fontSize,i.style.display="inline-block",i.style.width="50%",i.style.cursor="pointer",i.style.textAlign="center",i.style.padding=$wcm.ccc(GAME_VIRTUAL_WIDTH/20)+"px",i.style.boxSizing="border-box",i.style.background="#eee",n.appendChild(i),s.push(i),i.addEventListener("click",()=>{t.parentElement.removeChild(t),n.parentElement.removeChild(n),WEBCOMPONENT.visible(!1),e.no()})}{let i=document.createElement("div");i.classList.add("font_light"),i.textContent="동의함",i.style.fontSize=a.fontSize,i.style.display="inline-block",i.style.width="50%",i.style.cursor="pointer",i.style.textAlign="center",i.style.padding=$wcm.ccc(GAME_VIRTUAL_WIDTH/20)+"px",i.style.boxSizing="border-box",i.style.background="#eee",n.appendChild(i),s.push(i),i.addEventListener("click",()=>{t.parentElement.removeChild(t),n.parentElement.removeChild(n),WEBCOMPONENT.visible(!1),e.yes()})}let p=n.getBoundingClientRect().height-2*i-(o.getBoundingClientRect().height+s[0].getBoundingClientRect().height)-2*i;l.style.height=p.toFixed(2)+"px"}},make_basic_office({title:e,container:t,group:i,btn:c}){let n=new PIXI.Container;n.x=0,n.y=0,t.addChild(n),n.parentGroup=i;let o=$pxi.image_sprite(xk.res_list.office_pattern);o.x=$pxi.ccc(0),o.y=$pxi.ccc(GAME_VIRTUAL_HEIGHT/6),o.width=$pxi.ccc(GAME_VIRTUAL_WIDTH),n.addChild(o),o.parentGroup=i;let l=$pxi.image_sprite(xk.res_list.CAE1F3);l.x=$pxi.ccc(0),l.y=$pxi.ccc(0),l.width=$pxi.ccc(GAME_VIRTUAL_WIDTH),l.height=o.y,n.addChild(l),l.parentGroup=i;let r=$pxi.image_sprite(xk.res_list.white);r.x=$pxi.ccc(0),r.y=o.y+o.height,r.width=$pxi.ccc(GAME_VIRTUAL_WIDTH),r.height=$pxi.ccc(GAME_VIRTUAL_HEIGHT),n.addChild(r),r.parentGroup=i;let a=$pxi.image_sprite(xk.res_list.office_title);a.x=$pxi.ccc(0),a.y=$pxi.ccc(0),n.addChild(a),a.parentGroup=i;let s=$pxi.textlabel({text:e,size:$pxi.ccc(70),parent:n,family:"NEXON-Lv1-Gothic-Bold"});s.y+=($pxi.ccc(150)-($pxi.ccc(150)-s.height))/2,s.x+=($pxi.ccc(GAME_VIRTUAL_WIDTH)-s.width)/2;let p=$pxi.image_sprite(xk.res_list.white);function d(e,t){let c=$pxi.ccc(GAME_VIRTUAL_WIDTH/3),o=new PixiText({style:{fontFamily:$cpn.defaultFont,fill:"#ffffff",stroke:"#000000",strokeThickness:0,dropShadow:!0,dropShadowColor:"#ffffff",dropShadowBlur:0,dropShadowAngle:Math.PI/6,dropShadowDistance:0,align:"center"}}),l=o.getNode();o.text=e.res,o.size=$pxi.ccc(60),l.parentGroup=i,o.y=$pxi.ccc(GAME_VIRTUAL_HEIGHT)-p.height/2,o.x=(c-o.width/2)/2,0===t||(o.x=$pxi.ccc(GAME_VIRTUAL_WIDTH)-o.x),l.interactive=!0,l.mousedown=l.touchstart=function(){e.exe()},n.addChild(l)}return p.width=$pxi.ccc(GAME_VIRTUAL_WIDTH),p.height=$pxi.ccc(150),p.x=$pxi.ccc(0),p.y=$pxi.ccc(GAME_VIRTUAL_HEIGHT)-p.height,p.tint=10066329,n.addChild(p),p.parentGroup=i,d(c.negative,0),d(c.positive,1),{element:n,close:function(){n.parent.removeChild(n)}}}};