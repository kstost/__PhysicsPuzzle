function make_world(e){let t,i,n=0,o=[];function r(e){i=e.worldScale,t=planck.World(e.gravity)}function l(e){return{x:e.x/i,y:e.y/i}}function a(e){return{x:e.x*i,y:e.y*i}}r(e);let s={destroy:function(e,i){let n=e.getUserData().pixi_element;return i||n.parent.removeChild(n),function(e){for(let t=o.length-1;t>=0;t--)o[t].list[0]!==e&&o[t].list[1]!==e||o.splice(t,1)}(e),t.destroyBody(e),n},detect:function(e,t,i,n){o.push({mode:e,list:[t,i],fn:n})},new_world:r,create_element:function({color:e,polynodes:o,name:r,x:l,y:a,width:s,height:c,radius:d,dynamic:p,friction:u,mass:x,restitution:g,img:m,parent_group:y,visible:f}){let v=y;n++;let h=l,I=a,_=t.createBody();p&&_.setDynamic();let k,P,w=null;if(w||void 0===d?w||void 0===s?w||void 0===o||(w=planck.Polygon):w=planck.Box:w=planck.Circle,w===planck.Circle&&(P=planck.Circle(d/2/i)),w===planck.Box&&(P=planck.Box(s/2/i,c/2/i)),w===planck.Polygon){let e,t,n,r,l=JSON.parse(JSON.stringify(o));for(let i=0,o=l.length;i<o;i++)void 0!==e&&void 0!==n||(e=l[i].x,n=l[i].x),void 0!==t&&void 0!==r||(t=l[i].y,r=l[i].y),e>l[i].x&&(e=l[i].x),t>l[i].y&&(t=l[i].y),n<l[i].x&&(n=l[i].x),r<l[i].y&&(r=l[i].y);for(let i=0,n=l.length;i<n;i++)l[i].x-=e,l[i].y-=t;s=n-e,c=r-t;let a=[];l.forEach(e=>{a.push(planck.Vec2((e.x-s/2)/2/i,(e.y-c/2)/2/i))}),P=planck.Polygon(a),o=l}k=_.createFixture(P,{density:1,friction:void 0===u?0:u}),void 0!==g&&k.setRestitution(g),_.setPosition(planck.Vec2(h/i,I/i)),_.setMassData({mass:void 0===x?1:x,center:planck.Vec2(0,0),I:1}),void 0===f&&(f=!0);let b=new PIXI.Graphics;if(b.visible=f,b.parentGroup=v,y.toContainer().addChild(b),void 0!==e&&(e=parseInt(e,16),b.beginFill(e)),w===planck.Box&&(b.drawRect(0,0,s,c),b.pivot.set(b.width/2,b.height/2)),w===planck.Circle&&(b.drawCircle(0,0,d/2),m)){let e=d/m.width,t=new PIXI.Sprite(m.texture);t.position.x=0,t.position.y=0,t.scale.x=e,t.scale.y=e,t.pivot.set(m.width/2,m.width/2),b.addChild(t)}if(w===planck.Polygon){let e=o,t=e=>e/2;b.moveTo(t(e[0].x),t(e[0].y));for(let i=1;i<e.length;i++)b.lineTo(t(e[i].x),t(e[i].y));b.closePath(),b.pivot.set(s/2/2,c/2/2)}b.position.x=h,b.position.y=I,b.endFill(),b.zOrder=1;let C={uid:n,planck_body:_,fixture:k,pixi_element:b};return b.extend_store=C,_.setUserData(C),_},get world(){return t},get worldScale(){return i},transpos:function(e){return e instanceof planck.Body?a(e.getPosition()):l(e.position)},planckpos_pixipos:a,pixipos_planckpos:l,planck_pos:function(e,t){if(!t){return a(e.getPosition())}e.setPosition(planck.Vec2(t.x/i,t.y/i))}};["begin-contact","end-contact","pre-solve","post-solve","remove-joint","remove-fixture","remove-body"].forEach(e=>{s.world.on(e,(function(t){if(t.getFixtureA&&t.getFixtureB){var i=t.getFixtureA().getBody(),n=t.getFixtureB().getBody();for(let t=0;t<o.length;t++)if(o[t].mode===e){let r=o[t].list;(r[1]===i&&r[0]===n||r[0]===i&&r[1]===n)&&o[t].fn(i,n,e)}}}))});return PIXI.Ticker.shared.add((function(e){const n=e*(1e3/60);t.step(n/1e3),t.clearForces();for(let e=t.getBodyList();e;e=e.getNext()){let t=e.getPosition(),n=e.getAngle(),o=e.getUserData();e.getFixtureList().getShape();planck.Circle,planck.Box,planck.Polygon,o.pixi_element.x=t.x*i,o.pixi_element.y=t.y*i,o.pixi_element.rotation=n}})),s}let constvalue={oneframe:1e3/60,easing:{linear:e=>e,easeInQuad:e=>e*e,easeOutQuad:e=>e*(2-e),easeInOutQuad:e=>e<.5?2*e*e:(4-2*e)*e-1,easeInCubic:e=>e*e*e,easeOutCubic:e=>--e*e*e+1,easeInOutCubic:e=>e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1,easeInQuart:e=>e*e*e*e,easeOutQuart:e=>1- --e*e*e*e,easeInOutQuart:e=>e<.5?8*e*e*e*e:1-8*--e*e*e*e,easeInQuint:e=>e*e*e*e*e,easeOutQuint:e=>1+--e*e*e*e*e,easeInOutQuint:e=>e<.5?16*e*e*e*e*e:1+16*--e*e*e*e*e}},animation={moveTo(e,t,i,n,o){let r,[l,a]=t;void 0===l.x&&void 0===l.y?r=0:void 0===l.x&&void 0!==l.y?(l.x=e.x,a.x=e.x,r=1):void 0!==l.x&&void 0===l.y?(l.y=e.y,a.y=e.y,r=2):void 0!==l.x&&void 0!==l.y&&(r=3),commonutil.animation((t,n)=>{let o=ksttool.math.get_coordinate_between_two_points(l,a,t);e.x=o.x,e.y=o.y,n&&i&&i()},n,o)}},commonutil={getRandomColor:function(){for(var e="",t=0;t<6;t++)e+="0123456789ABCDEF"[Math.floor(16*Math.random())];return e},clear_debug:function(){let e=$pxi.VS.get("debug_view_list");if(e)for(;e.length;){let t=e[0];PIXI.Ticker.shared.remove(t.animation),t.pixi_element instanceof PIXI.Graphics&&t.pixi_element.parent.removeChild(t.pixi_element),t.pixi_element instanceof PixiLine&&t.pixi_element.remove(),e.splice(0,1)}},debug:function(e,t){let i,n,o=t?PixiLine:PIXI.Graphics;n||(n=GAME_WIDTH/2*.005/2),$pxi.VS.get("debug_group")||$pxi.VS.set("debug_group",new PIXI.display.Group(2,!0)),o===PIXI.Graphics&&(i=new PIXI.Graphics,STAGE.addChild(i),i.position.x=e.x,i.position.y=e.y,i.zOrder=0,i.parentGroup=$pxi.VS.get("debug_group")),o===PixiLine&&(i=new PixiLine({stage:STAGE}),i.setPadding(n),i.setFirst(e),i.setSecond(t),i.setZOrder(0),i.line.node.parentGroup=$pxi.VS.get("debug_group")),$pxi.VS.get("debug_view_list")||$pxi.VS.set("debug_view_list",[]);let r=e=>{o===PixiLine&&i.setColor(parseInt(this.getRandomColor(),16)),o===PIXI.Graphics&&(i.clear(),i.beginFill(parseInt(this.getRandomColor(),16)),i.drawCircle(0,0,7*n),i.endFill())};PIXI.Ticker.shared.add(r),$pxi.VS.get("debug_view_list").push({pixi_element:i,animation:r});let l={remove:function(e){function t(){o===PIXI.Graphics&&l.node.parent&&l.node.parent.removeChild(l.node),o===PixiLine&&l.node.remove()}e?(async()=>{await commonutil.delay(e),t()})():t()},node:i};return l},animation:function(e,t,i){let n=t;t=60*t/1e3;let o=0,r=!1,l=!0;i||(i=constvalue.easing.linear);let a=function(n){if(l){o+=n,o>=t&&(PIXI.Ticker.shared.remove(a),o=t,r=!0);let l=s();o||t||(l=1),e(i(l),r,l)}};function s(){return o/t}function c(){let e=s();return{ratio:i(e),time:n}}return t?PIXI.Ticker.shared.add(a):(t=0,a(0)),{stop:()=>(l=!1,r||(PIXI.Ticker.shared.remove(a),r=!0),c()),pause:()=>(l=!1,c()),resume:()=>(l=!0,c())}},delay:async function(e){return e=60*e/1e3,new Promise(t=>{let i=0,n=function(o){i+=o,i>=e&&(PIXI.Ticker.shared.remove(n),t())};PIXI.Ticker.shared.add(n)})}};Object.keys(commonutil).forEach(e=>{commonutil[e]=commonutil[e].bind(commonutil)});